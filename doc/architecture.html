<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Stock Agent Ops - System Architecture</title>
<style>
  :root {
    --bg-primary: #0d1117;
    --bg-secondary: #161b22;
    --bg-tertiary: #21262d;
    --border: #30363d;
    --text-primary: #f0f6fc;
    --text-secondary: #c9d1d9;
    --text-muted: #8b949e;
    --text-dim: #484f58;
    --blue: #58a6ff;
    --blue-dim: #1f6feb;
    --purple: #bc8cff;
    --purple-dim: #8957e5;
    --green: #3fb950;
    --green-dim: #238636;
    --yellow: #d29922;
    --yellow-dim: #9e6a03;
    --red: #f85149;
    --red-dim: #da3633;
    --cyan: #39d2c0;
    --cyan-dim: #1b7c6f;
    --orange: #f0883e;
    --pink: #f778ba;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--bg-primary);
    color: var(--text-secondary);
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;
    line-height: 1.5;
    overflow-x: hidden;
  }

  /* ── Header ── */
  .hero {
    text-align: center;
    padding: 56px 24px 32px;
    border-bottom: 1px solid var(--border);
    background: linear-gradient(180deg, #0d1117 0%, #111820 100%);
  }
  .hero h1 {
    font-size: 36px;
    font-weight: 700;
    color: var(--text-primary);
    letter-spacing: -0.5px;
  }
  .hero .tagline {
    margin-top: 10px;
    font-size: 16px;
    color: var(--text-muted);
    max-width: 700px;
    margin-left: auto;
    margin-right: auto;
  }
  .hero .tech-pills {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin-top: 20px;
    flex-wrap: wrap;
  }
  .pill {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 5px 14px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 600;
    border: 1px solid var(--border);
    background: var(--bg-secondary);
    color: var(--text-secondary);
  }
  .pill .dot { width: 8px; height: 8px; border-radius: 50%; }

  /* ── Nav tabs ── */
  .tabs {
    display: flex;
    justify-content: center;
    gap: 4px;
    padding: 16px 24px 0;
    border-bottom: 1px solid var(--border);
    background: var(--bg-primary);
    position: sticky;
    top: 0;
    z-index: 100;
  }
  .tab {
    padding: 10px 20px;
    font-size: 13px;
    font-weight: 600;
    color: var(--text-muted);
    cursor: pointer;
    border-bottom: 2px solid transparent;
    transition: all 0.2s;
    background: none;
    border-top: none;
    border-left: none;
    border-right: none;
    font-family: inherit;
  }
  .tab:hover { color: var(--text-secondary); }
  .tab.active { color: var(--text-primary); border-bottom-color: var(--orange); }

  /* ── Panels ── */
  .panel { display: none; max-width: 1280px; margin: 0 auto; padding: 32px 24px 64px; }
  .panel.active { display: block; }

  /* ── Section titles ── */
  .section-title {
    font-size: 22px;
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: 8px;
  }
  .section-desc {
    font-size: 14px;
    color: var(--text-muted);
    margin-bottom: 28px;
    max-width: 640px;
  }

  /* ═══════════════════════════════════════════
     OVERVIEW PANEL – architecture diagram
     ═══════════════════════════════════════════ */
  .arch-container {
    position: relative;
    width: 100%;
  }

  /* Layers */
  .layer {
    margin-bottom: 20px;
    border-radius: 14px;
    border: 1px solid var(--border);
    overflow: hidden;
  }
  .layer-header {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 12px 20px;
    font-size: 11px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 1.5px;
    cursor: pointer;
    user-select: none;
  }
  .layer-header .layer-icon { font-size: 16px; }
  .layer-header .expand-hint {
    margin-left: auto;
    font-size: 10px;
    font-weight: 500;
    text-transform: none;
    letter-spacing: 0;
    opacity: 0.5;
  }
  .layer-body {
    display: grid;
    gap: 14px;
    padding: 4px 20px 20px;
  }

  .layer.user { background: #0d1a2d; border-color: #1f4a7a; }
  .layer.user .layer-header { color: var(--blue); }
  .layer.user .layer-body { grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); }

  .layer.api { background: #150d24; border-color: #3b2566; }
  .layer.api .layer-header { color: var(--purple); }
  .layer.api .layer-body { grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); }

  .layer.ml { background: #0d1f15; border-color: #1a5c30; }
  .layer.ml .layer-header { color: var(--green); }
  .layer.ml .layer-body { grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); }

  .layer.llm { background: #1f1708; border-color: #6b4a0a; }
  .layer.llm .layer-header { color: var(--yellow); }
  .layer.llm .layer-body { grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); }

  .layer.storage { background: #1f0d0d; border-color: #6b1a1a; }
  .layer.storage .layer-header { color: var(--red); }
  .layer.storage .layer-body { grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); }

  .layer.monitoring { background: #0d1f1d; border-color: #1a5c50; }
  .layer.monitoring .layer-header { color: var(--cyan); }
  .layer.monitoring .layer-body { grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); }

  /* Component cards */
  .comp {
    background: var(--bg-secondary);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 16px;
    transition: all 0.2s;
    cursor: default;
    position: relative;
  }
  .comp:hover {
    border-color: #444c56;
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(0,0,0,0.35);
  }
  .comp-top {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 8px;
  }
  .comp-icon {
    width: 36px;
    height: 36px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    flex-shrink: 0;
  }
  .comp-name {
    font-size: 14px;
    font-weight: 600;
    color: var(--text-primary);
  }
  .comp-tech {
    font-size: 11px;
    color: var(--text-muted);
    margin-top: 1px;
  }
  .comp-desc {
    font-size: 12px;
    color: var(--text-secondary);
    line-height: 1.6;
    margin-bottom: 10px;
  }
  .comp-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
  }
  .comp-tag {
    font-size: 10px;
    padding: 2px 8px;
    border-radius: 10px;
    background: var(--bg-tertiary);
    color: var(--text-muted);
    border: 1px solid var(--border);
    white-space: nowrap;
  }
  .comp-port {
    position: absolute;
    top: 12px;
    right: 14px;
    font-size: 10px;
    font-weight: 700;
    padding: 2px 8px;
    border-radius: 8px;
    font-family: 'SF Mono', 'Fira Code', monospace;
  }

  .layer.user .comp-icon { background: #1a3a5c; }
  .layer.user .comp-port { background: #1a3a5c; color: var(--blue); }
  .layer.api .comp-icon { background: #2a1f3d; }
  .layer.api .comp-port { background: #2a1f3d; color: var(--purple); }
  .layer.ml .comp-icon { background: #1a3329; }
  .layer.ml .comp-port { background: #1a3329; color: var(--green); }
  .layer.llm .comp-icon { background: #3d2f1a; }
  .layer.llm .comp-port { background: #3d2f1a; color: var(--yellow); }
  .layer.storage .comp-icon { background: #3d1a1a; }
  .layer.storage .comp-port { background: #3d1a1a; color: var(--red); }
  .layer.monitoring .comp-icon { background: #1a2f3d; }
  .layer.monitoring .comp-port { background: #1a2f3d; color: var(--cyan); }

  /* ═══════════════════════════════════════════
     CONNECTIONS – SVG diagram
     ═══════════════════════════════════════════ */
  .connections-wrap {
    margin-top: 32px;
    background: var(--bg-secondary);
    border: 1px solid var(--border);
    border-radius: 14px;
    padding: 28px 20px;
    overflow-x: auto;
  }
  .connections-wrap h3 {
    font-size: 15px;
    font-weight: 600;
    color: var(--text-primary);
    text-align: center;
    margin-bottom: 20px;
  }
  .conn-diagram {
    display: flex;
    justify-content: center;
    min-height: 500px;
    position: relative;
  }
  .conn-diagram svg {
    width: 100%;
    max-width: 1000px;
    height: auto;
  }

  /* ═══════════════════════════════════════════
     FLOWS PANEL – request lifecycle cards
     ═══════════════════════════════════════════ */
  .flow-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(360px, 1fr));
    gap: 20px;
  }
  .flow-card {
    background: var(--bg-secondary);
    border: 1px solid var(--border);
    border-radius: 12px;
    overflow: hidden;
  }
  .flow-card-header {
    padding: 16px 20px;
    font-size: 13px;
    font-weight: 700;
    display: flex;
    align-items: center;
    gap: 10px;
  }
  .flow-card-header code {
    font-size: 12px;
    font-weight: 400;
    color: var(--text-muted);
    background: var(--bg-tertiary);
    padding: 2px 8px;
    border-radius: 4px;
    font-family: 'SF Mono', 'Fira Code', monospace;
  }
  .flow-card-body { padding: 0 20px 20px; }
  .flow-step {
    display: flex;
    gap: 12px;
    padding: 10px 0;
    border-top: 1px solid #21262d;
  }
  .flow-step:first-child { border-top: none; }
  .step-num {
    width: 24px;
    height: 24px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 11px;
    font-weight: 700;
    color: var(--text-primary);
    flex-shrink: 0;
    margin-top: 1px;
  }
  .step-text {
    font-size: 13px;
    line-height: 1.55;
    color: var(--text-secondary);
  }
  .step-text code {
    font-size: 11px;
    background: var(--bg-tertiary);
    padding: 1px 6px;
    border-radius: 3px;
    color: var(--text-muted);
    font-family: 'SF Mono', 'Fira Code', monospace;
  }
  .step-text .aside {
    display: block;
    font-size: 11px;
    color: var(--text-dim);
    margin-top: 3px;
  }
  .flow-card.predict .flow-card-header { color: var(--green); border-bottom: 2px solid var(--green-dim); }
  .flow-card.predict .step-num { background: var(--green-dim); }
  .flow-card.analyze .flow-card-header { color: var(--yellow); border-bottom: 2px solid var(--yellow-dim); }
  .flow-card.analyze .step-num { background: var(--yellow-dim); }
  .flow-card.train .flow-card-header { color: var(--purple); border-bottom: 2px solid var(--purple-dim); }
  .flow-card.train .step-num { background: var(--purple-dim); }
  .flow-card.monitor .flow-card-header { color: var(--cyan); border-bottom: 2px solid var(--cyan-dim); }
  .flow-card.monitor .step-num { background: var(--cyan-dim); }
  .flow-card.system .flow-card-header { color: var(--orange); border-bottom: 2px solid #7a4510; }
  .flow-card.system .step-num { background: #7a4510; }

  /* ═══════════════════════════════════════════
     ENDPOINTS PANEL – API reference
     ═══════════════════════════════════════════ */
  .endpoint-group {
    margin-bottom: 32px;
  }
  .endpoint-group-title {
    font-size: 14px;
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: 12px;
    padding-bottom: 8px;
    border-bottom: 1px solid var(--border);
  }
  .endpoint-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 13px;
  }
  .endpoint-table th {
    text-align: left;
    padding: 8px 12px;
    font-size: 11px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: var(--text-dim);
    border-bottom: 1px solid var(--border);
  }
  .endpoint-table td {
    padding: 10px 12px;
    border-bottom: 1px solid #1c2028;
    vertical-align: top;
  }
  .endpoint-table tr:hover td { background: rgba(255,255,255,0.02); }
  .method {
    display: inline-block;
    padding: 2px 8px;
    border-radius: 4px;
    font-size: 11px;
    font-weight: 700;
    font-family: 'SF Mono', 'Fira Code', monospace;
    min-width: 52px;
    text-align: center;
  }
  .method.get { background: #0d2818; color: var(--green); }
  .method.post { background: #1a1a0d; color: var(--yellow); }
  .method.delete { background: #2d0d0d; color: var(--red); }
  .path-cell {
    font-family: 'SF Mono', 'Fira Code', monospace;
    font-size: 12px;
    color: var(--blue);
  }
  .rate-badge {
    font-size: 10px;
    padding: 2px 6px;
    border-radius: 8px;
    background: var(--bg-tertiary);
    color: var(--text-dim);
    white-space: nowrap;
  }

  /* ═══════════════════════════════════════════
     INFRA PANEL – Docker / K8s / Config
     ═══════════════════════════════════════════ */
  .infra-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
    gap: 20px;
    margin-bottom: 32px;
  }
  .infra-card {
    background: var(--bg-secondary);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 20px;
  }
  .infra-card h3 {
    font-size: 14px;
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 14px;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .infra-card h3 .ic { font-size: 18px; }
  .infra-list {
    list-style: none;
    font-size: 12px;
  }
  .infra-list li {
    padding: 6px 0;
    border-top: 1px solid #1c2028;
    display: flex;
    justify-content: space-between;
    align-items: baseline;
  }
  .infra-list li:first-child { border-top: none; }
  .infra-list .il-key { color: var(--text-secondary); }
  .infra-list .il-val {
    font-family: 'SF Mono', 'Fira Code', monospace;
    font-size: 11px;
    color: var(--text-muted);
    text-align: right;
  }

  .file-tree {
    font-family: 'SF Mono', 'Fira Code', monospace;
    font-size: 12px;
    line-height: 1.8;
    color: var(--text-muted);
    background: var(--bg-primary);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 16px;
    overflow-x: auto;
  }
  .file-tree .dir { color: var(--blue); }
  .file-tree .file { color: var(--text-secondary); }
  .file-tree .note { color: var(--text-dim); font-style: italic; }

  /* ═══════════════════════════════════════════
     MODEL PANEL – ML architecture detail
     ═══════════════════════════════════════════ */
  .model-detail-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(360px, 1fr));
    gap: 20px;
    margin-bottom: 32px;
  }
  .model-card {
    background: var(--bg-secondary);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 24px;
  }
  .model-card h3 {
    font-size: 15px;
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: 4px;
  }
  .model-card .mc-sub {
    font-size: 12px;
    color: var(--text-muted);
    margin-bottom: 16px;
  }
  .model-card .mc-diagram {
    background: var(--bg-primary);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 16px;
    font-family: 'SF Mono', 'Fira Code', monospace;
    font-size: 12px;
    line-height: 1.8;
    color: var(--text-secondary);
    overflow-x: auto;
    white-space: pre;
    margin-bottom: 14px;
  }
  .model-card table {
    width: 100%;
    border-collapse: collapse;
    font-size: 12px;
  }
  .model-card th {
    text-align: left;
    font-size: 10px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.8px;
    color: var(--text-dim);
    padding: 6px 0;
    border-bottom: 1px solid var(--border);
  }
  .model-card td {
    padding: 6px 0;
    border-bottom: 1px solid #1c2028;
    color: var(--text-secondary);
  }
  .model-card td:last-child {
    text-align: right;
    font-family: 'SF Mono', 'Fira Code', monospace;
    font-size: 11px;
    color: var(--text-muted);
  }

  /* ── Footer ── */
  footer {
    text-align: center;
    padding: 24px;
    color: var(--text-dim);
    font-size: 12px;
    border-top: 1px solid var(--border);
  }
  footer a { color: var(--text-muted); text-decoration: none; }
  footer a:hover { color: var(--text-secondary); }

  /* ── Responsive ── */
  @media (max-width: 768px) {
    .hero h1 { font-size: 26px; }
    .tabs { overflow-x: auto; justify-content: flex-start; padding-left: 12px; }
    .flow-grid { grid-template-columns: 1fr; }
    .infra-grid { grid-template-columns: 1fr; }
    .model-detail-grid { grid-template-columns: 1fr; }
    .endpoint-table { font-size: 11px; }
  }
</style>
</head>
<body>

<!-- ═══ Hero ═══ -->
<div class="hero">
  <h1>Stock Agent Ops</h1>
  <p class="tagline">End-to-end MLOps platform combining transfer-learning LSTM forecasting, LLM-powered analysis, and production-grade observability.</p>
  <div class="tech-pills">
    <span class="pill"><span class="dot" style="background:var(--blue)"></span>Go + Chi</span>
    <span class="pill"><span class="dot" style="background:var(--green)"></span>PyTorch LSTM</span>
    <span class="pill"><span class="dot" style="background:var(--yellow)"></span>llama.cpp / Qwen3 7B</span>
    <span class="pill"><span class="dot" style="background:var(--purple)"></span>LangGraph</span>
    <span class="pill"><span class="dot" style="background:var(--red)"></span>Redis + Qdrant + Feast</span>
    <span class="pill"><span class="dot" style="background:var(--cyan)"></span>Prometheus + Grafana</span>
    <span class="pill"><span class="dot" style="background:var(--orange)"></span>React + Vite + Tailwind</span>
  </div>
</div>

<!-- ═══ Tabs ═══ -->
<div class="tabs" id="tabs">
  <button class="tab active" data-panel="overview">Overview</button>
  <button class="tab" data-panel="flows">Data Flows</button>
  <button class="tab" data-panel="endpoints">API Reference</button>
  <button class="tab" data-panel="models">ML Models</button>
  <button class="tab" data-panel="infra">Infrastructure</button>
</div>

<!-- ═══════════════════════════════════════════════════
     PANEL: OVERVIEW
     ═══════════════════════════════════════════════════ -->
<div class="panel active" id="panel-overview">
  <h2 class="section-title">System Architecture</h2>
  <p class="section-desc">A Go API orchestrates Python ML pipelines via CLI subprocess, backed by Redis state, Qdrant semantic caching, and a local llama.cpp LLM server.</p>

  <div class="arch-container">

    <!-- User Layer -->
    <div class="layer user">
      <div class="layer-header">
        <span class="layer-icon">&#x1F464;</span> Presentation Layer
        <span class="expand-hint">2 components</span>
      </div>
      <div class="layer-body">
        <div class="comp">
          <span class="comp-port">:8501</span>
          <div class="comp-top">
            <div class="comp-icon">&#x1F4CA;</div>
            <div>
              <div class="comp-name">Frontend UI</div>
              <div class="comp-tech">React + Vite + Tailwind</div>
            </div>
          </div>
          <div class="comp-desc">Unified SPA combining analysis and monitoring. Analysis tab: enter a ticker, view 5-day OHLCV forecasts as Plotly charts, read Bloomberg-style LLM reports. Monitor tab: training controls, drift reports, agent evaluation scores, system logs, and cache status via API endpoints.</div>
          <div class="comp-tags">
            <span class="comp-tag">POST /analyze</span>
            <span class="comp-tag">POST /predict-child</span>
            <span class="comp-tag">GET /status</span>
            <span class="comp-tag">POST /train-*</span>
            <span class="comp-tag">POST /monitor/*</span>
            <span class="comp-tag">GET /system/logs</span>
          </div>
        </div>
      </div>
    </div>

    <!-- API Layer -->
    <div class="layer api">
      <div class="layer-header">
        <span class="layer-icon">&#x26A1;</span> API &amp; Orchestration Layer
        <span class="expand-hint">3 components</span>
      </div>
      <div class="layer-body">
        <div class="comp">
          <span class="comp-port">:8000</span>
          <div class="comp-top">
            <div class="comp-icon">&#x26A1;</div>
            <div>
              <div class="comp-name">Go API Server</div>
              <div class="comp-tech">Go + Chi router</div>
            </div>
          </div>
          <div class="comp-desc">Central HTTP server with 20+ endpoints. Middleware stack: CORS, panic recovery, request logging, Redis-backed rate limiting. Graceful shutdown with 30s timeout.</div>
          <div class="comp-tags">
            <span class="comp-tag">CORS</span>
            <span class="comp-tag">Rate Limiting</span>
            <span class="comp-tag">Prometheus /metrics</span>
            <span class="comp-tag">Swagger /docs</span>
          </div>
        </div>
        <div class="comp">
          <div class="comp-top">
            <div class="comp-icon">&#x1F40D;</div>
            <div>
              <div class="comp-name">Python ML CLI</div>
              <div class="comp-tech">scripts/ml_cli.py</div>
            </div>
          </div>
          <div class="comp-desc">CLI wrapper invoked by Go via subprocess. Handles all ML/LLM operations with JSON stdout output and non-zero exit on error. 7 subcommands covering train, predict, analyze, and monitor.</div>
          <div class="comp-tags">
            <span class="comp-tag">train-parent</span>
            <span class="comp-tag">train-child</span>
            <span class="comp-tag">predict-*</span>
            <span class="comp-tag">analyze</span>
            <span class="comp-tag">monitor-*</span>
          </div>
        </div>
        <div class="comp">
          <div class="comp-top">
            <div class="comp-icon">&#x2699;</div>
            <div>
              <div class="comp-name">Task Manager</div>
              <div class="comp-tech">Go goroutines + Redis</div>
            </div>
          </div>
          <div class="comp-desc">Background job orchestration with a semaphore pool (max 4 workers). Stores task status in Redis with TTL (2h running, 1h completed). Supports chain callbacks for auto-predict after training.</div>
          <div class="comp-tags">
            <span class="comp-tag">4 max workers</span>
            <span class="comp-tag">Redis status tracking</span>
            <span class="comp-tag">Chain callbacks</span>
          </div>
        </div>
      </div>
    </div>

    <!-- ML Layer -->
    <div class="layer ml">
      <div class="layer-header">
        <span class="layer-icon">&#x1F9EA;</span> Machine Learning Layer
        <span class="expand-hint">5 components</span>
      </div>
      <div class="layer-body">
        <div class="comp">
          <div class="comp-top">
            <div class="comp-icon">&#x1F3DB;</div>
            <div>
              <div class="comp-name">Parent Model</div>
              <div class="comp-tech">S&amp;P 500 LSTM</div>
            </div>
          </div>
          <div class="comp-desc">Base model trained from scratch on ^GSPC data (since 2004). 3-layer LSTM, 128 hidden units, 20 epochs. Learns general market dynamics as foundation for transfer learning.</div>
          <div class="comp-tags">
            <span class="comp-tag">7 features</span>
            <span class="comp-tag">60-day context</span>
            <span class="comp-tag">20 epochs</span>
            <span class="comp-tag">Adam optimizer</span>
          </div>
        </div>
        <div class="comp">
          <div class="comp-top">
            <div class="comp-icon">&#x1F4C8;</div>
            <div>
              <div class="comp-name">Child Models</div>
              <div class="comp-tech">Per-ticker LSTM</div>
            </div>
          </div>
          <div class="comp-desc">Fine-tuned from parent weights via transfer learning. Freezes LSTM layers (or fine-tunes all), trains FC layer for 10 epochs at lower LR (1e-4). One model per ticker.</div>
          <div class="comp-tags">
            <span class="comp-tag">Transfer learning</span>
            <span class="comp-tag">10 epochs</span>
            <span class="comp-tag">Freeze / fine-tune</span>
          </div>
        </div>
        <div class="comp">
          <div class="comp-top">
            <div class="comp-icon">&#x1F52E;</div>
            <div>
              <div class="comp-name">Inference Engine</div>
              <div class="comp-tech">src/pipelines/inference_pipeline.py</div>
            </div>
          </div>
          <div class="comp-desc">Loads trained model + scaler, fetches latest OHLCV + technicals, normalizes, runs 5-day + 1-day forecast, denormalizes, returns JSON with 30-day history and 5-day prediction.</div>
          <div class="comp-tags">
            <span class="comp-tag">5-day horizon</span>
            <span class="comp-tag">OHLCV output</span>
            <span class="comp-tag">Feast integration</span>
          </div>
        </div>
        <div class="comp">
          <div class="comp-top">
            <div class="comp-icon">&#x1F4E5;</div>
            <div>
              <div class="comp-name">Data Ingestion</div>
              <div class="comp-tech">yfinance + RSI/MACD</div>
            </div>
          </div>
          <div class="comp-desc">Fetches OHLCV from Yahoo Finance, computes RSI-14 and MACD technical indicators. File-locked Parquet writes for race-condition safety. Materializes features into Feast store.</div>
          <div class="comp-tags">
            <span class="comp-tag">yfinance</span>
            <span class="comp-tag">RSI-14</span>
            <span class="comp-tag">MACD</span>
            <span class="comp-tag">fcntl lock</span>
          </div>
        </div>
        <div class="comp">
          <div class="comp-top">
            <div class="comp-icon">&#x1F4D0;</div>
            <div>
              <div class="comp-name">Data Preparation</div>
              <div class="comp-tech">PyTorch Dataset</div>
            </div>
          </div>
          <div class="comp-desc">Sliding-window dataset: 60-day input context mapped to 5-day output horizon. StandardScaler normalization. 80/20 train/val split. Batch size 32.</div>
          <div class="comp-tags">
            <span class="comp-tag">Sliding window</span>
            <span class="comp-tag">StandardScaler</span>
            <span class="comp-tag">Batch 32</span>
          </div>
        </div>
      </div>
    </div>

    <!-- LLM / Agent Layer -->
    <div class="layer llm">
      <div class="layer-header">
        <span class="layer-icon">&#x1F9E0;</span> LLM &amp; Agent Layer
        <span class="expand-hint">4 components</span>
      </div>
      <div class="layer-body">
        <div class="comp">
          <span class="comp-port">:8080</span>
          <div class="comp-top">
            <div class="comp-icon">&#x1F9E0;</div>
            <div>
              <div class="comp-name">llama.cpp Server</div>
              <div class="comp-tech">Qwen3 7B (Q4_K_M)</div>
            </div>
          </div>
          <div class="comp-desc">Local LLM server with OpenAI-compatible API. Runs Qwen3 7B quantized (~4.4 GB). 4096 context, 2 parallel slots, CPU-only by default. Also serves embeddings endpoint.</div>
          <div class="comp-tags">
            <span class="comp-tag">/v1/chat/completions</span>
            <span class="comp-tag">/v1/embeddings</span>
            <span class="comp-tag">4096 ctx</span>
          </div>
        </div>
        <div class="comp">
          <div class="comp-top">
            <div class="comp-icon">&#x1F916;</div>
            <div>
              <div class="comp-name">LangGraph Agent</div>
              <div class="comp-tech">src/agents/graph.py</div>
            </div>
          </div>
          <div class="comp-desc">Single-call analysis pipeline: checks semantic cache, fetches predictions + news, sends one LLM prompt, returns Bloomberg-style report with Market Stance and Confidence.</div>
          <div class="comp-tags">
            <span class="comp-tag">Semantic cache check</span>
            <span class="comp-tag">Single LLM call</span>
            <span class="comp-tag">3-4 paragraph report</span>
          </div>
        </div>
        <div class="comp">
          <div class="comp-top">
            <div class="comp-icon">&#x1F4F0;</div>
            <div>
              <div class="comp-name">News Fetcher</div>
              <div class="comp-tech">src/agents/tools.py</div>
            </div>
          </div>
          <div class="comp-desc">Fetches latest stock news. Tries Finnhub API first (7-day window), falls back to Yahoo Finance scraping. Returns top 5 articles with headlines and summaries (max 1000 chars).</div>
          <div class="comp-tags">
            <span class="comp-tag">Finnhub API</span>
            <span class="comp-tag">Yahoo fallback</span>
            <span class="comp-tag">Top 5 articles</span>
          </div>
        </div>
        <div class="comp">
          <div class="comp-top">
            <div class="comp-icon">&#x1F517;</div>
            <div>
              <div class="comp-name">LLM Provider</div>
              <div class="comp-tech">src/llm/provider.py</div>
            </div>
          </div>
          <div class="comp-desc">Abstraction layer for LLM + embedding clients. Priority: llama.cpp (default) &rarr; Ollama (fallback) &rarr; Mock. Supports tool binding. Temperature 0.3, max 2048 tokens.</div>
          <div class="comp-tags">
            <span class="comp-tag">ChatOpenAI</span>
            <span class="comp-tag">OpenAIEmbeddings</span>
            <span class="comp-tag">Auto-fallback</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Storage Layer -->
    <div class="layer storage">
      <div class="layer-header">
        <span class="layer-icon">&#x1F4BE;</span> Storage Layer
        <span class="expand-hint">5 components</span>
      </div>
      <div class="layer-body">
        <div class="comp">
          <span class="comp-port">:6379</span>
          <div class="comp-top">
            <div class="comp-icon">&#x1F534;</div>
            <div>
              <div class="comp-name">Redis</div>
              <div class="comp-tech">redis/redis-stack</div>
            </div>
          </div>
          <div class="comp-desc">Multi-purpose store: prediction cache (24h TTL), task status tracking (2h/1h TTL), rate limit counters (sliding window), and Feast online feature store.</div>
          <div class="comp-tags">
            <span class="comp-tag">predict_child_{ticker}</span>
            <span class="comp-tag">task_status:{id}</span>
            <span class="comp-tag">rate_limit:*</span>
          </div>
        </div>
        <div class="comp">
          <span class="comp-port">:6333</span>
          <div class="comp-top">
            <div class="comp-icon">&#x1F537;</div>
            <div>
              <div class="comp-name">Qdrant</div>
              <div class="comp-tech">Vector database</div>
            </div>
          </div>
          <div class="comp-desc">Semantic cache for LLM analysis reports. 768-dim embeddings (nomic-embed-text), cosine similarity, 0.95 threshold. Collection: <code>dataset_cache</code>, 24h TTL.</div>
          <div class="comp-tags">
            <span class="comp-tag">768-dim vectors</span>
            <span class="comp-tag">Cosine distance</span>
            <span class="comp-tag">24h TTL</span>
          </div>
        </div>
        <div class="comp">
          <div class="comp-top">
            <div class="comp-icon">&#x1F37D;</div>
            <div>
              <div class="comp-name">Feast</div>
              <div class="comp-tech">Feature store</div>
            </div>
          </div>
          <div class="comp-desc">Consistent feature serving for training and inference. Offline store: Parquet files. Online store: Redis. Entity: ticker. Features: OHLCV + RSI-14 + MACD.</div>
          <div class="comp-tags">
            <span class="comp-tag">Parquet offline</span>
            <span class="comp-tag">Redis online</span>
            <span class="comp-tag">7 features</span>
          </div>
        </div>
        <div class="comp">
          <div class="comp-top">
            <div class="comp-icon">&#x1F4CB;</div>
            <div>
              <div class="comp-name">MLflow</div>
              <div class="comp-tech">Experiment tracking</div>
            </div>
          </div>
          <div class="comp-desc">Logs training params, metrics (MSE, RMSE, R&sup2;), and model artifacts per run. Optional remote tracking via DagsHub. Stores runs in local <code>mlruns/</code> directory.</div>
          <div class="comp-tags">
            <span class="comp-tag">Params + metrics</span>
            <span class="comp-tag">Model registry</span>
            <span class="comp-tag">DagsHub (optional)</span>
          </div>
        </div>
        <div class="comp">
          <div class="comp-top">
            <div class="comp-icon">&#x1F4C1;</div>
            <div>
              <div class="comp-name">Filesystem</div>
              <div class="comp-tech">outputs/ + logs/</div>
            </div>
          </div>
          <div class="comp-desc">Persistent model artifacts, drift reports, agent evaluations, and application logs. Structured layout: <code>outputs/parent/</code>, <code>outputs/{ticker}/</code> with drift and eval subdirectories.</div>
          <div class="comp-tags">
            <span class="comp-tag">*.pt models</span>
            <span class="comp-tag">*.pkl scalers</span>
            <span class="comp-tag">drift JSON</span>
            <span class="comp-tag">eval JSON</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Monitoring Layer -->
    <div class="layer monitoring">
      <div class="layer-header">
        <span class="layer-icon">&#x1F4C9;</span> Observability Layer
        <span class="expand-hint">4 components</span>
      </div>
      <div class="layer-body">
        <div class="comp">
          <span class="comp-port">:9090</span>
          <div class="comp-top">
            <div class="comp-icon">&#x1F4C9;</div>
            <div>
              <div class="comp-name">Prometheus</div>
              <div class="comp-tech">Metrics collector</div>
            </div>
          </div>
          <div class="comp-desc">Scrapes Go API <code>/metrics</code> every 5s. Collects system metrics (CPU, RAM, disk), Redis health, training duration, prediction latency, and cache hit/miss rates.</div>
          <div class="comp-tags">
            <span class="comp-tag">system_*</span>
            <span class="comp-tag">training_*</span>
            <span class="comp-tag">prediction_*</span>
            <span class="comp-tag">redis_cache_*</span>
          </div>
        </div>
        <div class="comp">
          <span class="comp-port">:3000</span>
          <div class="comp-top">
            <div class="comp-icon">&#x1F4CA;</div>
            <div>
              <div class="comp-name">Grafana</div>
              <div class="comp-tech">Dashboard UI</div>
            </div>
          </div>
          <div class="comp-desc">Auto-provisioned dashboards visualizing training status, prediction counts, cache efficiency, and system resources. Default credentials: admin/admin.</div>
          <div class="comp-tags">
            <span class="comp-tag">Auto-provisioned</span>
            <span class="comp-tag">Prometheus datasource</span>
          </div>
        </div>
        <div class="comp">
          <div class="comp-top">
            <div class="comp-icon">&#x1F4CF;</div>
            <div>
              <div class="comp-name">Drift Detection</div>
              <div class="comp-tech">src/monitoring/drift.py</div>
            </div>
          </div>
          <div class="comp-desc">Custom drift scoring: Z-score mean shift (data drift) + volatility ratio (concept drift). Reference window 180 days vs current 30 days. Health: Healthy / Degraded / Critical.</div>
          <div class="comp-tags">
            <span class="comp-tag">Z-score shift</span>
            <span class="comp-tag">Volatility ratio</span>
            <span class="comp-tag">Per-feature metrics</span>
          </div>
        </div>
        <div class="comp">
          <div class="comp-top">
            <div class="comp-icon">&#x2705;</div>
            <div>
              <div class="comp-name">Agent Evaluation</div>
              <div class="comp-tech">src/monitoring/agent_eval.py</div>
            </div>
          </div>
          <div class="comp-desc">Heuristic evaluation of LLM output quality. Checks: ticker relevance, trustworthiness (sources + numeric data), recommendation presence. Score 0.0&ndash;1.0, status: Trustworthy / Questionable.</div>
          <div class="comp-tags">
            <span class="comp-tag">3 heuristic checks</span>
            <span class="comp-tag">Relevance + trust</span>
            <span class="comp-tag">JSON reports</span>
          </div>
        </div>
      </div>
    </div>

  </div><!-- .arch-container -->

  <!-- Connection Diagram -->
  <div class="connections-wrap">
    <h3>Component Connectivity</h3>
    <div class="conn-diagram">
      <svg viewBox="0 0 960 540" xmlns="http://www.w3.org/2000/svg">
        <defs>
          <marker id="arrow-blue" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto"><path d="M0,0 L8,3 L0,6" fill="var(--blue)" opacity="0.7"/></marker>
          <marker id="arrow-purple" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto"><path d="M0,0 L8,3 L0,6" fill="var(--purple)" opacity="0.7"/></marker>
          <marker id="arrow-green" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto"><path d="M0,0 L8,3 L0,6" fill="var(--green)" opacity="0.7"/></marker>
          <marker id="arrow-yellow" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto"><path d="M0,0 L8,3 L0,6" fill="var(--yellow)" opacity="0.7"/></marker>
          <marker id="arrow-red" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto"><path d="M0,0 L8,3 L0,6" fill="var(--red)" opacity="0.7"/></marker>
          <marker id="arrow-cyan" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto"><path d="M0,0 L8,3 L0,6" fill="var(--cyan)" opacity="0.7"/></marker>
        </defs>

        <!-- Background layer boxes -->
        <rect x="20" y="10" width="200" height="75" rx="8" fill="none" stroke="var(--blue)" stroke-opacity="0.15" stroke-dasharray="4 3"/>
        <text x="30" y="28" font-size="9" fill="var(--blue)" opacity="0.5" font-weight="700" font-family="system-ui">USER</text>

        <rect x="300" y="10" width="370" height="75" rx="8" fill="none" stroke="var(--purple)" stroke-opacity="0.15" stroke-dasharray="4 3"/>
        <text x="310" y="28" font-size="9" fill="var(--purple)" opacity="0.5" font-weight="700" font-family="system-ui">API</text>

        <rect x="20" y="115" width="440" height="130" rx="8" fill="none" stroke="var(--green)" stroke-opacity="0.15" stroke-dasharray="4 3"/>
        <text x="30" y="133" font-size="9" fill="var(--green)" opacity="0.5" font-weight="700" font-family="system-ui">ML PIPELINE</text>

        <rect x="490" y="115" width="450" height="130" rx="8" fill="none" stroke="var(--yellow)" stroke-opacity="0.15" stroke-dasharray="4 3"/>
        <text x="500" y="133" font-size="9" fill="var(--yellow)" opacity="0.5" font-weight="700" font-family="system-ui">LLM / AGENT</text>

        <rect x="20" y="280" width="660" height="120" rx="8" fill="none" stroke="var(--red)" stroke-opacity="0.15" stroke-dasharray="4 3"/>
        <text x="30" y="298" font-size="9" fill="var(--red)" opacity="0.5" font-weight="700" font-family="system-ui">STORAGE</text>

        <rect x="710" y="280" width="230" height="120" rx="8" fill="none" stroke="var(--cyan)" stroke-opacity="0.15" stroke-dasharray="4 3"/>
        <text x="720" y="298" font-size="9" fill="var(--cyan)" opacity="0.5" font-weight="700" font-family="system-ui">OBSERVABILITY</text>

        <!-- Nodes: User -->
        <rect x="35" y="38" width="80" height="36" rx="6" fill="#1a3a5c" stroke="var(--blue-dim)" stroke-width="1"/>
        <text x="75" y="55" text-anchor="middle" font-size="10" fill="var(--text-primary)" font-weight="600" font-family="system-ui">Frontend</text>
        <text x="75" y="67" text-anchor="middle" font-size="8" fill="var(--text-muted)" font-family="system-ui">:8501</text>

        <!-- Monitor UI merged into Frontend SPA -->

        <!-- Nodes: API -->
        <rect x="320" y="35" width="100" height="42" rx="6" fill="#2a1f3d" stroke="var(--purple-dim)" stroke-width="1"/>
        <text x="370" y="53" text-anchor="middle" font-size="11" fill="var(--text-primary)" font-weight="700" font-family="system-ui">Go API</text>
        <text x="370" y="67" text-anchor="middle" font-size="8" fill="var(--text-muted)" font-family="system-ui">Chi :8000</text>

        <rect x="440" y="35" width="100" height="42" rx="6" fill="#2a1f3d" stroke="var(--purple-dim)" stroke-width="1"/>
        <text x="490" y="53" text-anchor="middle" font-size="10" fill="var(--text-primary)" font-weight="600" font-family="system-ui">ML CLI</text>
        <text x="490" y="67" text-anchor="middle" font-size="8" fill="var(--text-muted)" font-family="system-ui">subprocess</text>

        <rect x="560" y="35" width="100" height="42" rx="6" fill="#2a1f3d" stroke="var(--purple-dim)" stroke-width="1"/>
        <text x="610" y="53" text-anchor="middle" font-size="10" fill="var(--text-primary)" font-weight="600" font-family="system-ui">Task Mgr</text>
        <text x="610" y="67" text-anchor="middle" font-size="8" fill="var(--text-muted)" font-family="system-ui">4 workers</text>

        <!-- Nodes: ML -->
        <rect x="35" y="145" width="90" height="42" rx="6" fill="#1a3329" stroke="var(--green-dim)" stroke-width="1"/>
        <text x="80" y="162" text-anchor="middle" font-size="10" fill="var(--text-primary)" font-weight="600" font-family="system-ui">Parent</text>
        <text x="80" y="178" text-anchor="middle" font-size="8" fill="var(--text-muted)" font-family="system-ui">^GSPC LSTM</text>

        <rect x="140" y="145" width="90" height="42" rx="6" fill="#1a3329" stroke="var(--green-dim)" stroke-width="1"/>
        <text x="185" y="162" text-anchor="middle" font-size="10" fill="var(--text-primary)" font-weight="600" font-family="system-ui">Child</text>
        <text x="185" y="178" text-anchor="middle" font-size="8" fill="var(--text-muted)" font-family="system-ui">Per-ticker</text>

        <rect x="250" y="145" width="90" height="42" rx="6" fill="#1a3329" stroke="var(--green-dim)" stroke-width="1"/>
        <text x="295" y="162" text-anchor="middle" font-size="10" fill="var(--text-primary)" font-weight="600" font-family="system-ui">Inference</text>
        <text x="295" y="178" text-anchor="middle" font-size="8" fill="var(--text-muted)" font-family="system-ui">5-day forecast</text>

        <rect x="355" y="145" width="90" height="42" rx="6" fill="#1a3329" stroke="var(--green-dim)" stroke-width="1"/>
        <text x="400" y="162" text-anchor="middle" font-size="10" fill="var(--text-primary)" font-weight="600" font-family="system-ui">Ingestion</text>
        <text x="400" y="178" text-anchor="middle" font-size="8" fill="var(--text-muted)" font-family="system-ui">yfinance</text>

        <!-- Arrow: Parent -> Child (transfer learning) -->
        <line x1="125" y1="166" x2="140" y2="166" stroke="var(--green)" stroke-width="1.5" opacity="0.6" marker-end="url(#arrow-green)"/>
        <text x="132" y="158" font-size="7" fill="var(--green)" opacity="0.6" font-family="system-ui" text-anchor="middle">TL</text>

        <!-- Nodes: LLM -->
        <rect x="510" y="145" width="100" height="42" rx="6" fill="#3d2f1a" stroke="#6b4a0a" stroke-width="1"/>
        <text x="560" y="162" text-anchor="middle" font-size="10" fill="var(--text-primary)" font-weight="600" font-family="system-ui">llama.cpp</text>
        <text x="560" y="178" text-anchor="middle" font-size="8" fill="var(--text-muted)" font-family="system-ui">Qwen3 7B :8080</text>

        <rect x="625" y="145" width="100" height="42" rx="6" fill="#3d2f1a" stroke="#6b4a0a" stroke-width="1"/>
        <text x="675" y="162" text-anchor="middle" font-size="10" fill="var(--text-primary)" font-weight="600" font-family="system-ui">LangGraph</text>
        <text x="675" y="178" text-anchor="middle" font-size="8" fill="var(--text-muted)" font-family="system-ui">Agent</text>

        <rect x="740" y="145" width="100" height="42" rx="6" fill="#3d2f1a" stroke="#6b4a0a" stroke-width="1"/>
        <text x="790" y="162" text-anchor="middle" font-size="10" fill="var(--text-primary)" font-weight="600" font-family="system-ui">News</text>
        <text x="790" y="178" text-anchor="middle" font-size="8" fill="var(--text-muted)" font-family="system-ui">Finnhub/Yahoo</text>

        <rect x="625" y="198" width="100" height="36" rx="6" fill="#3d2f1a" stroke="#6b4a0a" stroke-width="1"/>
        <text x="675" y="215" text-anchor="middle" font-size="10" fill="var(--text-primary)" font-weight="600" font-family="system-ui">Provider</text>
        <text x="675" y="227" text-anchor="middle" font-size="8" fill="var(--text-muted)" font-family="system-ui">LLM abstraction</text>

        <!-- Nodes: Storage -->
        <rect x="40" y="310" width="100" height="42" rx="6" fill="#3d1a1a" stroke="var(--red-dim)" stroke-width="1"/>
        <text x="90" y="327" text-anchor="middle" font-size="11" fill="var(--text-primary)" font-weight="600" font-family="system-ui">Redis</text>
        <text x="90" y="343" text-anchor="middle" font-size="8" fill="var(--text-muted)" font-family="system-ui">:6379</text>

        <rect x="160" y="310" width="100" height="42" rx="6" fill="#3d1a1a" stroke="var(--red-dim)" stroke-width="1"/>
        <text x="210" y="327" text-anchor="middle" font-size="11" fill="var(--text-primary)" font-weight="600" font-family="system-ui">Qdrant</text>
        <text x="210" y="343" text-anchor="middle" font-size="8" fill="var(--text-muted)" font-family="system-ui">:6333</text>

        <rect x="280" y="310" width="100" height="42" rx="6" fill="#3d1a1a" stroke="var(--red-dim)" stroke-width="1"/>
        <text x="330" y="327" text-anchor="middle" font-size="11" fill="var(--text-primary)" font-weight="600" font-family="system-ui">Feast</text>
        <text x="330" y="343" text-anchor="middle" font-size="8" fill="var(--text-muted)" font-family="system-ui">Features</text>

        <rect x="400" y="310" width="100" height="42" rx="6" fill="#3d1a1a" stroke="var(--red-dim)" stroke-width="1"/>
        <text x="450" y="327" text-anchor="middle" font-size="11" fill="var(--text-primary)" font-weight="600" font-family="system-ui">MLflow</text>
        <text x="450" y="343" text-anchor="middle" font-size="8" fill="var(--text-muted)" font-family="system-ui">Tracking</text>

        <rect x="525" y="310" width="100" height="42" rx="6" fill="#3d1a1a" stroke="var(--red-dim)" stroke-width="1"/>
        <text x="575" y="327" text-anchor="middle" font-size="11" fill="var(--text-primary)" font-weight="600" font-family="system-ui">Filesystem</text>
        <text x="575" y="343" text-anchor="middle" font-size="8" fill="var(--text-muted)" font-family="system-ui">outputs/</text>

        <!-- Nodes: Monitoring -->
        <rect x="725" y="310" width="90" height="42" rx="6" fill="#1a2f3d" stroke="var(--cyan-dim)" stroke-width="1"/>
        <text x="770" y="327" text-anchor="middle" font-size="10" fill="var(--text-primary)" font-weight="600" font-family="system-ui">Prometheus</text>
        <text x="770" y="343" text-anchor="middle" font-size="8" fill="var(--text-muted)" font-family="system-ui">:9090</text>

        <rect x="830" y="310" width="90" height="42" rx="6" fill="#1a2f3d" stroke="var(--cyan-dim)" stroke-width="1"/>
        <text x="875" y="327" text-anchor="middle" font-size="10" fill="var(--text-primary)" font-weight="600" font-family="system-ui">Grafana</text>
        <text x="875" y="343" text-anchor="middle" font-size="8" fill="var(--text-muted)" font-family="system-ui">:3000</text>

        <!-- ── Connection lines ── -->
        <!-- User -> API -->
        <line x1="115" y1="56" x2="320" y2="56" stroke="var(--blue)" stroke-width="1.5" opacity="0.4" marker-end="url(#arrow-blue)"/>
        <line x1="210" y1="56" x2="320" y2="56" stroke="var(--blue)" stroke-width="1.5" opacity="0.4" marker-end="url(#arrow-blue)"/>

        <!-- API -> ML CLI -->
        <line x1="420" y1="56" x2="440" y2="56" stroke="var(--purple)" stroke-width="1.5" opacity="0.5" marker-end="url(#arrow-purple)"/>

        <!-- API -> Task Mgr -->
        <line x1="420" y1="62" x2="420" y2="62" stroke="var(--purple)" stroke-width="1" opacity="0.3"/>
        <path d="M420,62 L430,62 L430,56 L560,56" fill="none" stroke="var(--purple)" stroke-width="1.2" opacity="0.35" marker-end="url(#arrow-purple)"/>

        <!-- ML CLI -> ML components -->
        <line x1="490" y1="77" x2="80" y2="145" stroke="var(--green)" stroke-width="1.2" opacity="0.35" marker-end="url(#arrow-green)"/>
        <line x1="490" y1="77" x2="185" y2="145" stroke="var(--green)" stroke-width="1.2" opacity="0.35" marker-end="url(#arrow-green)"/>
        <line x1="490" y1="77" x2="295" y2="145" stroke="var(--green)" stroke-width="1.2" opacity="0.35" marker-end="url(#arrow-green)"/>

        <!-- ML CLI -> LLM agent -->
        <line x1="490" y1="77" x2="675" y2="145" stroke="var(--yellow)" stroke-width="1.2" opacity="0.35" marker-end="url(#arrow-yellow)"/>

        <!-- Agent -> llama.cpp -->
        <line x1="625" y1="166" x2="610" y2="166" stroke="var(--yellow)" stroke-width="1.5" opacity="0.5" marker-end="url(#arrow-yellow)"/>

        <!-- Agent -> News -->
        <line x1="725" y1="166" x2="740" y2="166" stroke="var(--yellow)" stroke-width="1.5" opacity="0.5" marker-end="url(#arrow-yellow)"/>

        <!-- Agent -> Provider -->
        <line x1="675" y1="187" x2="675" y2="198" stroke="var(--yellow)" stroke-width="1" opacity="0.35" marker-end="url(#arrow-yellow)"/>

        <!-- Provider -> llama.cpp -->
        <path d="M625,216 L610,216 L610,187" fill="none" stroke="var(--yellow)" stroke-width="1" opacity="0.25" stroke-dasharray="3 2"/>

        <!-- API -> Redis -->
        <line x1="370" y1="77" x2="90" y2="310" stroke="var(--red)" stroke-width="1.2" opacity="0.3" marker-end="url(#arrow-red)"/>

        <!-- Task Mgr -> Redis -->
        <line x1="610" y1="77" x2="90" y2="310" stroke="var(--red)" stroke-width="1" opacity="0.2" stroke-dasharray="4 3"/>

        <!-- Agent -> Qdrant -->
        <line x1="675" y1="187" x2="210" y2="310" stroke="var(--red)" stroke-width="1" opacity="0.25" marker-end="url(#arrow-red)"/>

        <!-- Ingestion -> Feast -->
        <line x1="400" y1="187" x2="330" y2="310" stroke="var(--red)" stroke-width="1" opacity="0.25" marker-end="url(#arrow-red)"/>

        <!-- Inference -> Filesystem -->
        <line x1="295" y1="187" x2="575" y2="310" stroke="var(--red)" stroke-width="1" opacity="0.2" marker-end="url(#arrow-red)"/>

        <!-- API -> Prometheus -->
        <path d="M370,77 L370,90 Q370,95 375,95 L770,95 L770,310" fill="none" stroke="var(--cyan)" stroke-width="1" opacity="0.25" stroke-dasharray="4 3" marker-end="url(#arrow-cyan)"/>
        <text x="580" y="90" font-size="7" fill="var(--cyan)" opacity="0.5" font-family="system-ui">/metrics scrape</text>

        <!-- Prometheus -> Grafana -->
        <line x1="815" y1="331" x2="830" y2="331" stroke="var(--cyan)" stroke-width="1.5" opacity="0.5" marker-end="url(#arrow-cyan)"/>

        <!-- Legend at bottom -->
        <g transform="translate(20, 380)">
          <text font-size="9" fill="var(--text-dim)" font-weight="700" font-family="system-ui">LEGEND</text>
          <line x1="0" y1="18" x2="30" y2="18" stroke="var(--blue)" stroke-width="1.5" opacity="0.6" marker-end="url(#arrow-blue)"/>
          <text x="38" y="22" font-size="8" fill="var(--text-muted)" font-family="system-ui">HTTP request</text>
          <line x1="120" y1="18" x2="150" y2="18" stroke="var(--purple)" stroke-width="1.5" opacity="0.6" marker-end="url(#arrow-purple)"/>
          <text x="158" y="22" font-size="8" fill="var(--text-muted)" font-family="system-ui">Subprocess / internal</text>
          <line x1="290" y1="18" x2="320" y2="18" stroke="var(--green)" stroke-width="1.5" opacity="0.6" marker-end="url(#arrow-green)"/>
          <text x="328" y="22" font-size="8" fill="var(--text-muted)" font-family="system-ui">ML data flow</text>
          <line x1="420" y1="18" x2="450" y2="18" stroke="var(--yellow)" stroke-width="1.5" opacity="0.6" marker-end="url(#arrow-yellow)"/>
          <text x="458" y="22" font-size="8" fill="var(--text-muted)" font-family="system-ui">LLM flow</text>
          <line x1="530" y1="18" x2="560" y2="18" stroke="var(--red)" stroke-width="1.5" opacity="0.6" marker-end="url(#arrow-red)"/>
          <text x="568" y="22" font-size="8" fill="var(--text-muted)" font-family="system-ui">Storage I/O</text>
          <line x1="640" y1="18" x2="670" y2="18" stroke="var(--cyan)" stroke-width="1.5" opacity="0.5" stroke-dasharray="4 3" marker-end="url(#arrow-cyan)"/>
          <text x="678" y="22" font-size="8" fill="var(--text-muted)" font-family="system-ui">Observability</text>
        </g>

        <!-- Port summary at bottom -->
        <g transform="translate(20, 420)">
          <text font-size="9" fill="var(--text-dim)" font-weight="700" font-family="system-ui">PORTS</text>
          <text x="0" y="18" font-size="9" fill="var(--text-muted)" font-family="monospace">8000 API   8080 LLM   8501 Frontend   6379 Redis   6333 Qdrant   9090 Prom   3000 Grafana</text>
        </g>
      </svg>
    </div>
  </div>

</div>

<!-- ═══════════════════════════════════════════════════
     PANEL: FLOWS
     ═══════════════════════════════════════════════════ -->
<div class="panel" id="panel-flows">
  <h2 class="section-title">Request Flows</h2>
  <p class="section-desc">Step-by-step lifecycle of the core API operations, showing exactly how data moves through each component.</p>

  <div class="flow-grid">

    <div class="flow-card predict">
      <div class="flow-card-header">Prediction <code>POST /predict-child</code></div>
      <div class="flow-card-body">
        <div class="flow-step"><div class="step-num">1</div><div class="step-text">Go API checks Redis cache for <code>predict_child_{ticker}</code><span class="aside">24h TTL, returns immediately on hit</span></div></div>
        <div class="flow-step"><div class="step-num">2</div><div class="step-text">Cache miss: checks if parent model exists at <code>outputs/parent/</code><span class="aside">If missing, triggers parent training and returns 202</span></div></div>
        <div class="flow-step"><div class="step-num">3</div><div class="step-text">Calls <code>python ml_cli.py predict-child --ticker AAPL</code><span class="aside">Context timeout: 120s, env vars passed through</span></div></div>
        <div class="flow-step"><div class="step-num">4</div><div class="step-text">Python loads child model + scaler, fetches latest data from yfinance, computes RSI-14 and MACD</div></div>
        <div class="flow-step"><div class="step-num">5</div><div class="step-text">LSTM runs inference: 60-day context window &rarr; 5-day OHLCV forecast + 30-day history</div></div>
        <div class="flow-step"><div class="step-num">6</div><div class="step-text">Go caches JSON result in Redis (24h TTL), updates <code>prediction_total</code> counter, returns <code>{"result":{...}}</code><span class="aside">If model missing: auto-trains in background, returns 202 with task_id</span></div></div>
      </div>
    </div>

    <div class="flow-card analyze">
      <div class="flow-card-header">Analysis <code>POST /analyze</code></div>
      <div class="flow-card-body">
        <div class="flow-step"><div class="step-num">1</div><div class="step-text">Go API calls <code>python ml_cli.py analyze --ticker AAPL</code><span class="aside">Longest-running endpoint, timeout: 120s</span></div></div>
        <div class="flow-step"><div class="step-num">2</div><div class="step-text">Python checks Qdrant semantic cache: embed query, search for similarity &gt; 0.95 with same ticker and &lt; 24h<span class="aside">768-dim nomic-embed-text vectors, cosine distance</span></div></div>
        <div class="flow-step"><div class="step-num">3</div><div class="step-text">Cache miss: fetches predictions via <code>predict_child()</code> + news from Finnhub (or Yahoo fallback)</div></div>
        <div class="flow-step"><div class="step-num">4</div><div class="step-text">Sends predictions + news to llama.cpp (Qwen3 7B) in a single LLM call<span class="aside">Prompt asks for Bloomberg-style report with Market Stance + Confidence</span></div></div>
        <div class="flow-step"><div class="step-num">5</div><div class="step-text">LLM returns 3-4 paragraph report. Python parses Market Stance (BULLISH/BEARISH/NEUTRAL) and Confidence (High/Medium/Low)</div></div>
        <div class="flow-step"><div class="step-num">6</div><div class="step-text">Result embedded and cached in Qdrant (24h TTL), returned with final_report, recommendation, confidence, and predictions</div></div>
      </div>
    </div>

    <div class="flow-card train">
      <div class="flow-card-header">Training <code>POST /train-child</code></div>
      <div class="flow-card-body">
        <div class="flow-step"><div class="step-num">1</div><div class="step-text">Go API checks if parent model exists; if not, starts parent training first and returns <code>started_parent</code></div></div>
        <div class="flow-step"><div class="step-num">2</div><div class="step-text">Task Manager acquires semaphore slot (max 4 concurrent), sets Redis status to <code>running</code> (2h TTL)</div></div>
        <div class="flow-step"><div class="step-num">3</div><div class="step-text">Background goroutine calls <code>python ml_cli.py train-child --ticker AAPL</code><span class="aside">Timeout: 7200s (2 hours) for training operations</span></div></div>
        <div class="flow-step"><div class="step-num">4</div><div class="step-text">Python loads parent weights, freezes LSTM layers (or fine-tunes all), trains FC layer for 10 epochs at LR 1e-4</div></div>
        <div class="flow-step"><div class="step-num">5</div><div class="step-text">Saves model + scaler to <code>outputs/{TICKER}/</code>, logs params and metrics (MSE, RMSE, R&sup2;) to MLflow</div></div>
        <div class="flow-step"><div class="step-num">6</div><div class="step-text">Redis status updated to <code>completed</code> (1h TTL). Optional chain callback runs prediction and caches result</div></div>
      </div>
    </div>

    <div class="flow-card monitor">
      <div class="flow-card-header">Monitoring <code>POST /monitor/{ticker}</code></div>
      <div class="flow-card-body">
        <div class="flow-step"><div class="step-num">1</div><div class="step-text">Go API calls <code>python ml_cli.py monitor-ticker --ticker AAPL</code></div></div>
        <div class="flow-step"><div class="step-num">2</div><div class="step-text"><strong>Drift detection:</strong> fetches reference data (180 days) and current data (30 days) from yfinance</div></div>
        <div class="flow-step"><div class="step-num">3</div><div class="step-text">Calculates Z-score mean shift per feature (data drift) and volatility ratio (concept drift)<span class="aside">Health: Healthy (&lt;1.0) / Degraded (1.0-2.0) / Critical (&gt;2.0)</span></div></div>
        <div class="flow-step"><div class="step-num">4</div><div class="step-text"><strong>Agent evaluation:</strong> runs <code>analyze_stock()</code>, applies 3 heuristic checks: relevance, trustworthiness, recommendation presence</div></div>
        <div class="flow-step"><div class="step-num">5</div><div class="step-text">Saves drift + eval JSON to <code>outputs/{ticker}/drift/</code> and <code>outputs/{ticker}/agent_eval/</code> (latest + timestamped copies)</div></div>
      </div>
    </div>

    <div class="flow-card system">
      <div class="flow-card-header">Auto-Healing <code>Missing Model Recovery</code></div>
      <div class="flow-card-body">
        <div class="flow-step"><div class="step-num">1</div><div class="step-text"><code>/predict-child</code> request arrives for untrained ticker</div></div>
        <div class="flow-step"><div class="step-num">2</div><div class="step-text">Go checks <code>outputs/{ticker}/{ticker}_child_model.pt</code> &mdash; file not found</div></div>
        <div class="flow-step"><div class="step-num">3</div><div class="step-text">Task Manager starts background training with chain callback to cache prediction when done</div></div>
        <div class="flow-step"><div class="step-num">4</div><div class="step-text">Returns <strong>202 Accepted</strong> with <code>{"status":"training", "task_id":"aapl"}</code>. Client polls <code>GET /status/aapl</code></div></div>
        <div class="flow-step"><div class="step-num">5</div><div class="step-text">If parent also missing: chains parent &rarr; child training. Full recovery is automatic</div></div>
      </div>
    </div>

    <div class="flow-card system">
      <div class="flow-card-header">Cache Strategy <code>Multi-layer Caching</code></div>
      <div class="flow-card-body">
        <div class="flow-step"><div class="step-num">L1</div><div class="step-text"><strong>Redis prediction cache</strong> &mdash; <code>predict_child_{ticker}</code>, 24h TTL. Checked first on every prediction request. Hit rate tracked by Prometheus</div></div>
        <div class="flow-step"><div class="step-num">L2</div><div class="step-text"><strong>Qdrant semantic cache</strong> &mdash; Analysis reports cached by ticker + embedding similarity. 768-dim cosine search, threshold 0.95. 24h TTL</div></div>
        <div class="flow-step"><div class="step-num">L3</div><div class="step-text"><strong>Feast feature store</strong> &mdash; Online features materialized to Redis from Parquet offline store. Consistent training/serving features</div></div>
      </div>
    </div>

  </div>
</div>

<!-- ═══════════════════════════════════════════════════
     PANEL: ENDPOINTS
     ═══════════════════════════════════════════════════ -->
<div class="panel" id="panel-endpoints">
  <h2 class="section-title">API Reference</h2>
  <p class="section-desc">All endpoints exposed by the Go API server on port 8000.</p>

  <div class="endpoint-group">
    <div class="endpoint-group-title">Core Operations</div>
    <table class="endpoint-table">
      <thead><tr><th>Method</th><th>Path</th><th>Description</th><th>Rate Limit</th></tr></thead>
      <tbody>
        <tr><td><span class="method post">POST</span></td><td class="path-cell">/train-parent</td><td>Train parent LSTM on S&amp;P 500 (background)</td><td><span class="rate-badge">5/hour</span></td></tr>
        <tr><td><span class="method post">POST</span></td><td class="path-cell">/train-child</td><td>Train child model for ticker (auto-trains parent if missing)</td><td><span class="rate-badge">5/hour</span></td></tr>
        <tr><td><span class="method post">POST</span></td><td class="path-cell">/predict-parent</td><td>Run parent model inference</td><td><span class="rate-badge">40/hour</span></td></tr>
        <tr><td><span class="method post">POST</span></td><td class="path-cell">/predict-child</td><td>Run child inference (auto-trains if missing, returns 202)</td><td><span class="rate-badge">40/hour</span></td></tr>
        <tr><td><span class="method post">POST</span></td><td class="path-cell">/analyze</td><td>Full LLM-powered analysis with Bloomberg-style report</td><td>&mdash;</td></tr>
        <tr><td><span class="method get">GET</span></td><td class="path-cell">/status/{task_id}</td><td>Check training task progress</td><td>&mdash;</td></tr>
      </tbody>
    </table>
  </div>

  <div class="endpoint-group">
    <div class="endpoint-group-title">Monitoring</div>
    <table class="endpoint-table">
      <thead><tr><th>Method</th><th>Path</th><th>Description</th><th>Rate Limit</th></tr></thead>
      <tbody>
        <tr><td><span class="method post">POST</span></td><td class="path-cell">/monitor/parent</td><td>Drift detection + agent evaluation for parent model</td><td>&mdash;</td></tr>
        <tr><td><span class="method post">POST</span></td><td class="path-cell">/monitor/{ticker}</td><td>Drift detection + agent evaluation for child model</td><td>&mdash;</td></tr>
        <tr><td><span class="method get">GET</span></td><td class="path-cell">/monitor/{ticker}/drift</td><td>Latest drift report JSON</td><td>&mdash;</td></tr>
        <tr><td><span class="method get">GET</span></td><td class="path-cell">/monitor/{ticker}/eval</td><td>Latest agent evaluation report JSON</td><td>&mdash;</td></tr>
      </tbody>
    </table>
  </div>

  <div class="endpoint-group">
    <div class="endpoint-group-title">System</div>
    <table class="endpoint-table">
      <thead><tr><th>Method</th><th>Path</th><th>Description</th><th>Rate Limit</th></tr></thead>
      <tbody>
        <tr><td><span class="method get">GET</span></td><td class="path-cell">/</td><td>Project info, version, endpoint list, quick start</td><td>&mdash;</td></tr>
        <tr><td><span class="method get">GET</span></td><td class="path-cell">/health</td><td>Liveness/readiness probe (K8s compatible)</td><td>&mdash;</td></tr>
        <tr><td><span class="method get">GET</span></td><td class="path-cell">/docs</td><td>Swagger UI (static)</td><td>&mdash;</td></tr>
        <tr><td><span class="method get">GET</span></td><td class="path-cell">/openapi.json</td><td>OpenAPI 3.0 spec</td><td>&mdash;</td></tr>
        <tr><td><span class="method get">GET</span></td><td class="path-cell">/metrics</td><td>Prometheus metrics (text format)</td><td>&mdash;</td></tr>
        <tr><td><span class="method get">GET</span></td><td class="path-cell">/system/logs</td><td>Tail latest log file (?lines=100)</td><td>&mdash;</td></tr>
        <tr><td><span class="method get">GET</span></td><td class="path-cell">/system/cache</td><td>List cached predictions (?ticker= to filter)</td><td>&mdash;</td></tr>
        <tr><td><span class="method delete">DEL</span></td><td class="path-cell">/system/reset</td><td>Wipe Redis, Qdrant, Feast, outputs</td><td>&mdash;</td></tr>
        <tr><td><span class="method get">GET</span></td><td class="path-cell">/outputs</td><td>Directory listing of all output artifacts</td><td>&mdash;</td></tr>
        <tr><td><span class="method get">GET</span></td><td class="path-cell">/outputs/{ticker}</td><td>Ticker-specific files grouped by category</td><td>&mdash;</td></tr>
      </tbody>
    </table>
  </div>

  <div class="endpoint-group">
    <div class="endpoint-group-title">Request / Response Examples</div>
    <div class="infra-grid">
      <div class="infra-card">
        <h3><span class="ic">&#x1F4E8;</span> POST /predict-child</h3>
        <div class="file-tree"><span class="note">Request:</span>
{"ticker": "AAPL"}

<span class="note">Response (200):</span>
{"result": {
  "predictions": {
    "full_forecast": [
      {"date": "2026-02-17", "open": 150.2,
       "high": 151.5, "low": 149.8, "close": 150.8}
    ]
  },
  "history": [{"date": "2026-02-13", "close": 149.5}]
}}

<span class="note">Response (202 - model missing):</span>
{"status": "training",
 "detail": "Model not found, training started",
 "task_id": "aapl"}</div>
      </div>
      <div class="infra-card">
        <h3><span class="ic">&#x1F4E8;</span> POST /analyze</h3>
        <div class="file-tree"><span class="note">Request:</span>
{"ticker": "AAPL", "use_fmi": false,
 "thread_id": "abc-123"}

<span class="note">Response (200):</span>
{"final_report": "Apple Inc (AAPL)...",
 "recommendation": "BULLISH",
 "confidence": "High",
 "last_price": 150.25,
 "predictions": {...}}</div>
      </div>
    </div>
  </div>
</div>

<!-- ═══════════════════════════════════════════════════
     PANEL: MODELS
     ═══════════════════════════════════════════════════ -->
<div class="panel" id="panel-models">
  <h2 class="section-title">ML Model Architecture</h2>
  <p class="section-desc">Transfer-learning LSTM for multi-ticker stock price forecasting with 7 input features and 5-day output horizon.</p>

  <div class="model-detail-grid">

    <div class="model-card">
      <h3>LSTM Architecture</h3>
      <div class="mc-sub">3-layer LSTM with fully-connected output head</div>
      <div class="mc-diagram">Input (batch, 60, 7)
  |
  v
LSTM Layer 1  (7 -> 128, dropout=0.2)
  |
LSTM Layer 2  (128 -> 128, dropout=0.2)
  |
LSTM Layer 3  (128 -> 128, dropout=0.2)
  |
  v
Last hidden state (batch, 128)
  |
  v
FC Layer  (128 -> 35)
  |
  v
Reshape  (batch, 5, 7)
  |
  v
Output: 5-day x 7-feature forecast</div>
      <table>
        <tr><th>Parameter</th><th>Value</th></tr>
        <tr><td>Input features</td><td>7</td></tr>
        <tr><td>Hidden size</td><td>128</td></tr>
        <tr><td>Num layers</td><td>3</td></tr>
        <tr><td>Dropout</td><td>0.2</td></tr>
        <tr><td>Context window</td><td>60 days</td></tr>
        <tr><td>Forecast horizon</td><td>5 days</td></tr>
        <tr><td>Device</td><td>CUDA / CPU</td></tr>
      </table>
    </div>

    <div class="model-card">
      <h3>Transfer Learning Strategy</h3>
      <div class="mc-sub">Parent &rarr; Child weight transfer with layer freezing</div>
      <div class="mc-diagram">Parent Training (^GSPC, S&P 500):
  Epochs: 20
  LR: default Adam
  Data: 2004-08-19 to present
  Strategy: Train all layers from scratch

          |  copy weights
          v

Child Training (per ticker):
  Epochs: 10
  LR: 1e-4 (lower)
  Strategy: "freeze" or "fine_tune"

  freeze:    LSTM layers frozen,
             only FC layer trains

  fine_tune: All layers train at
             lower learning rate</div>
      <table>
        <tr><th>Aspect</th><th>Parent</th></tr>
        <tr><td>Ticker</td><td>^GSPC</td></tr>
        <tr><td>Epochs</td><td>20</td></tr>
        <tr><td>Batch size</td><td>32</td></tr>
        <tr><td>Loss function</td><td>MSE</td></tr>
        <tr><td>Optimizer</td><td>Adam</td></tr>
        <tr><td>Train/Val split</td><td>80/20</td></tr>
      </table>
    </div>

    <div class="model-card">
      <h3>Input Features</h3>
      <div class="mc-sub">7 features from OHLCV + technical indicators</div>
      <table>
        <tr><th>Feature</th><th>Source</th></tr>
        <tr><td>Open</td><td>yfinance OHLCV</td></tr>
        <tr><td>High</td><td>yfinance OHLCV</td></tr>
        <tr><td>Low</td><td>yfinance OHLCV</td></tr>
        <tr><td>Close</td><td>yfinance OHLCV</td></tr>
        <tr><td>Volume</td><td>yfinance OHLCV</td></tr>
        <tr><td>RSI-14</td><td>14-period RSI</td></tr>
        <tr><td>MACD</td><td>12/26 EMA diff</td></tr>
      </table>
      <div class="mc-diagram" style="margin-top:14px">Normalization: StandardScaler (fit on training data)
Scaler saved alongside model as {ticker}_scaler.pkl
Applied at inference time for consistent scaling</div>
    </div>

    <div class="model-card">
      <h3>LLM Configuration</h3>
      <div class="mc-sub">Local inference with llama.cpp serving Qwen3 7B</div>
      <table>
        <tr><th>Parameter</th><th>Value</th></tr>
        <tr><td>Model</td><td>Qwen3 7B</td></tr>
        <tr><td>Quantization</td><td>Q4_K_M (~4.4 GB)</td></tr>
        <tr><td>Context size</td><td>4096 tokens</td></tr>
        <tr><td>Temperature</td><td>0.3</td></tr>
        <tr><td>Max tokens</td><td>2048</td></tr>
        <tr><td>Parallel slots</td><td>2</td></tr>
        <tr><td>Embedding dim</td><td>768</td></tr>
        <tr><td>Embed model</td><td>nomic-embed-text</td></tr>
      </table>
      <div class="mc-diagram" style="margin-top:14px">Fallback chain:
  1. llama.cpp (LLAMA_CPP_BASE_URL)
  2. Ollama  (OLLAMA_BASE_URL)
  3. Mock client (development only)</div>
    </div>

    <div class="model-card">
      <h3>Drift Detection</h3>
      <div class="mc-sub">Custom Z-score + volatility monitoring</div>
      <div class="mc-diagram">Reference: 180 days prior
Current:   30 days recent

Data Drift (Z-score mean shift):
  score = |curr_mean - ref_mean| / ref_std
  per feature: Open, High, Low, Close, Volume

Concept Drift (Volatility ratio):
  ratio = curr_volatility / ref_volatility

Health Status:
  Healthy:  score < 1.0 AND ratio 0.6-1.5
  Degraded: score 1.0-2.0 OR ratio 1.5-2.5
  Critical: score > 2.0 OR ratio < 0.4 or > 2.5</div>
    </div>

    <div class="model-card">
      <h3>Agent Evaluation</h3>
      <div class="mc-sub">Heuristic quality scoring for LLM outputs</div>
      <div class="mc-diagram">Process:
  1. Run analyze_stock(ticker) via LLM
  2. Apply heuristic checks on output
  3. Score and save to JSON

Checks:
  Relevance:       Ticker mentioned?
  Trustworthiness: Sources + numeric data?
  Recommendation:  Contains stance keyword?

Score: passed_checks / total_checks (0.0-1.0)

Status:
  Trustworthy:  score > 0.6
  Questionable: score <= 0.6</div>
    </div>

  </div>
</div>

<!-- ═══════════════════════════════════════════════════
     PANEL: INFRASTRUCTURE
     ═══════════════════════════════════════════════════ -->
<div class="panel" id="panel-infra">
  <h2 class="section-title">Infrastructure</h2>
  <p class="section-desc">Docker Compose and Kubernetes deployment details, environment configuration, and filesystem layout.</p>

  <div class="infra-grid">

    <div class="infra-card">
      <h3><span class="ic">&#x1F433;</span> Docker Compose Services</h3>
      <ul class="infra-list">
        <li><span class="il-key">api (Go backend)</span><span class="il-val">:8000</span></li>
        <li><span class="il-key">llama (LLM server)</span><span class="il-val">:8080</span></li>
        <li><span class="il-key">redis (cache + state)</span><span class="il-val">:6379</span></li>
        <li><span class="il-key">qdrant (vector DB)</span><span class="il-val">:6333</span></li>
        <li><span class="il-key">prometheus (metrics)</span><span class="il-val">:9090</span></li>
        <li><span class="il-key">grafana (dashboards)</span><span class="il-val">:3000</span></li>
        <li><span class="il-key">frontend (React SPA)</span><span class="il-val">:8501</span></li>
      </ul>
    </div>

    <div class="infra-card">
      <h3><span class="ic">&#x2699;</span> Environment Variables</h3>
      <ul class="infra-list">
        <li><span class="il-key">PORT</span><span class="il-val">8000</span></li>
        <li><span class="il-key">REDIS_HOST</span><span class="il-val">localhost | redis</span></li>
        <li><span class="il-key">QDRANT_HOST</span><span class="il-val">localhost | qdrant</span></li>
        <li><span class="il-key">LLAMA_CPP_BASE_URL</span><span class="il-val">http://llama:8080/v1</span></li>
        <li><span class="il-key">LLM_MODEL</span><span class="il-val">qwen3-7b</span></li>
        <li><span class="il-key">API_URL</span><span class="il-val">http://localhost:8000</span></li>
        <li><span class="il-key">FMI_API_KEY</span><span class="il-val">(Finnhub key)</span></li>
        <li><span class="il-key">MLFLOW_TRACKING_URI</span><span class="il-val">(optional)</span></li>
      </ul>
    </div>

    <div class="infra-card">
      <h3><span class="ic">&#x2638;</span> Kubernetes Resources</h3>
      <ul class="infra-list">
        <li><span class="il-key">api Deployment</span><span class="il-val">1 replica</span></li>
        <li><span class="il-key">llama Deployment</span><span class="il-val">2-4 CPU, 4-8GB</span></li>
        <li><span class="il-key">redis-data-pvc</span><span class="il-val">RWO</span></li>
        <li><span class="il-key">qdrant-storage-pvc</span><span class="il-val">RWO</span></li>
        <li><span class="il-key">llama-models-pvc</span><span class="il-val">ROX</span></li>
        <li><span class="il-key">mlops-outputs-pvc</span><span class="il-val">shared</span></li>
        <li><span class="il-key">api Service</span><span class="il-val">LoadBalancer</span></li>
        <li><span class="il-key">grafana Service</span><span class="il-val">LoadBalancer</span></li>
      </ul>
    </div>

    <div class="infra-card">
      <h3><span class="ic">&#x1F534;</span> Redis Key Schema</h3>
      <ul class="infra-list">
        <li><span class="il-key">predict_child_{ticker}</span><span class="il-val">TTL 24h</span></li>
        <li><span class="il-key">task_status:{id} (running)</span><span class="il-val">TTL 2h</span></li>
        <li><span class="il-key">task_status:{id} (done)</span><span class="il-val">TTL 1h</span></li>
        <li><span class="il-key">task_status:{id} (failed)</span><span class="il-val">TTL 1h</span></li>
        <li><span class="il-key">rate_limit:{prefix}:{ts}</span><span class="il-val">TTL 1h</span></li>
      </ul>
    </div>

    <div class="infra-card">
      <h3><span class="ic">&#x1F4CA;</span> Prometheus Metrics</h3>
      <ul class="infra-list">
        <li><span class="il-key">system_cpu_percent</span><span class="il-val">Gauge</span></li>
        <li><span class="il-key">system_ram_used_mb</span><span class="il-val">Gauge</span></li>
        <li><span class="il-key">redis_up</span><span class="il-val">Gauge (0/1)</span></li>
        <li><span class="il-key">training_duration_seconds</span><span class="il-val">Histogram</span></li>
        <li><span class="il-key">prediction_total</span><span class="il-val">Counter</span></li>
        <li><span class="il-key">prediction_latency_seconds</span><span class="il-val">Histogram</span></li>
        <li><span class="il-key">redis_cache_hit_total</span><span class="il-val">Counter</span></li>
        <li><span class="il-key">redis_cache_miss_total</span><span class="il-val">Counter</span></li>
      </ul>
    </div>

    <div class="infra-card">
      <h3><span class="ic">&#x1F6E1;</span> Rate Limiting</h3>
      <ul class="infra-list">
        <li><span class="il-key">Training endpoints</span><span class="il-val">5 / hour</span></li>
        <li><span class="il-key">Prediction endpoints</span><span class="il-val">40 / hour</span></li>
        <li><span class="il-key">Algorithm</span><span class="il-val">Sliding window</span></li>
        <li><span class="il-key">Backend</span><span class="il-val">Redis INCR</span></li>
        <li><span class="il-key">Window resolution</span><span class="il-val">1 hour (Unix ts)</span></li>
      </ul>
    </div>

  </div>

  <!-- Filesystem layout -->
  <h3 style="font-size:15px; font-weight:600; color:var(--text-primary); margin-bottom:14px;">Filesystem Layout</h3>
  <div class="infra-grid">
    <div class="infra-card">
      <h3><span class="ic">&#x1F4C1;</span> Output Directory Structure</h3>
      <div class="file-tree"><span class="dir">outputs/</span>
  <span class="dir">parent/</span>
    <span class="file">^GSPC_parent_model.pt</span>     <span class="note"># PyTorch weights</span>
    <span class="file">^GSPC_parent_scaler.pkl</span>   <span class="note"># StandardScaler</span>
  <span class="dir">{TICKER}/</span>
    <span class="file">{TICKER}_child_model.pt</span>
    <span class="file">{TICKER}_child_scaler.pkl</span>
    <span class="dir">drift/</span>
      <span class="file">latest_drift.json</span>
      <span class="file">drift_{timestamp}.html</span>
    <span class="dir">agent_eval/</span>
      <span class="file">latest_eval.json</span>
      <span class="file">eval_{timestamp}.json</span>
    <span class="dir">plots/</span>
      <span class="file">predictions.png</span></div>
    </div>
    <div class="infra-card">
      <h3><span class="ic">&#x1F4C2;</span> Project Structure</h3>
      <div class="file-tree"><span class="dir">cmd/server/</span>          <span class="note"># Go entrypoint</span>
<span class="dir">internal/</span>
  <span class="dir">config/</span>             <span class="note"># Env + defaults</span>
  <span class="dir">http/</span>               <span class="note"># Chi router</span>
  <span class="dir">handlers/</span>           <span class="note"># HTTP handlers</span>
  <span class="dir">middleware/</span>         <span class="note"># CORS, rate limit</span>
  <span class="dir">metrics/</span>            <span class="note"># Prometheus</span>
  <span class="dir">services/</span>
    <span class="dir">python/</span>           <span class="note"># CLI subprocess runner</span>
    <span class="dir">redis/</span>            <span class="note"># Redis client</span>
    <span class="dir">cache/</span>            <span class="note"># Prediction cache</span>
    <span class="dir">tasks/</span>            <span class="note"># Background job mgr</span>
<span class="dir">scripts/</span>
  <span class="file">ml_cli.py</span>           <span class="note"># Python CLI wrapper</span>
<span class="dir">src/</span>
  <span class="dir">agents/</span>             <span class="note"># LangGraph + tools</span>
  <span class="dir">llm/</span>                <span class="note"># Provider abstraction</span>
  <span class="dir">model/</span>              <span class="note"># LSTM definition</span>
  <span class="dir">pipelines/</span>          <span class="note"># Train + inference</span>
  <span class="dir">monitoring/</span>         <span class="note"># Drift + eval</span>
  <span class="dir">data/</span>               <span class="note"># Ingestion + prep</span>
  <span class="dir">memory/</span>             <span class="note"># Semantic cache</span></div>
    </div>
  </div>
</div>

<!-- ═══ Footer ═══ -->
<footer>
  Stock Agent Ops &mdash; Go + Python + llama.cpp + PyTorch LSTM + LangGraph &mdash; <a href="https://github.com">View on GitHub</a>
</footer>

<!-- ═══ Tab switching ═══ -->
<script>
document.querySelectorAll('.tab').forEach(tab => {
  tab.addEventListener('click', () => {
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
    tab.classList.add('active');
    document.getElementById('panel-' + tab.dataset.panel).classList.add('active');
  });
});
</script>

</body>
</html>
